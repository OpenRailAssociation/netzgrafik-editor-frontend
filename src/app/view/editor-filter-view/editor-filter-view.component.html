<h2 class="SummaryTitle">{{ tFilter }}</h2>

<sbb-accordion [multi]="true">
  <sbb-expansion-panel [expanded]="true">
    <sbb-expansion-panel-header>
      <ng-container *ngIf="isTrainrunFilteringActive()">
        {{ tGeneral }}
      </ng-container>
      <ng-container *ngIf="!isTrainrunFilteringActive()">
        <label style="color: red">{{ tGeneral }}</label>
      </ng-container>
    </sbb-expansion-panel-header>

    <sbb-label>{{ tCategory }}</sbb-label>
    <div class="sbb-trainrun-chip-group">
      <button
        [class]="getCategoryClassname(trainrunCategory)"
        (click)="onCategoryChanged(trainrunCategory)"
        mode="ghost"
        [title]="getCategoryTooltip(trainrunCategory)"
        *ngFor="let trainrunCategory of dataService.getTrainrunCategories()"
      >
        {{ makeCategoryButtonLabel(trainrunCategory) }}
      </button>
    </div>

    <sbb-label class="sbb-mt-m">{{ tFrequency }}</sbb-label>
    <div class="sbb-trainrun-chip-group">
      <button
        [class]="getFrequencyClassname(trainrunFrequency)"
        (click)="onFrequencyChanged(trainrunFrequency)"
        mode="ghost"
        [title]="getFrequencyTooltip(trainrunFrequency)"
        *ngFor="let trainrunFrequency of dataService.getTrainrunFrequencies()"
      >
        {{ makeFrequencyButtonLabel(trainrunFrequency) }}
      </button>
    </div>

    <sbb-label class="sbb-mt-m">{{ tTimeCategory }}</sbb-label>
    <div class="sbb-trainrun-chip-group">
      <button
        [class]="getTimeCategoryClassname(trainrunTimeCategory)"
        (click)="onTimeCategoryChanged(trainrunTimeCategory)"
        mode="ghost"
        [title]="getTimeCategoryTooltip(trainrunTimeCategory)"
        *ngFor="
          let trainrunTimeCategory of dataService.getTrainrunTimeCategories()
        "
      >
        {{ makeTimeCategoryButtonLabel(trainrunTimeCategory) }}
      </button>
    </div>

    <button
      sbb-secondary-button
      class="sbb-mt-m"
      [disabled]="isTrainrunFilteringActive()"
      [title]="tDisplayAllTrainruns"
      (click)="onResetTrainrunFilter()"
    >
      {{ tResetTrainrunFilter }}
    </button>
  </sbb-expansion-panel>

  <sbb-expansion-panel [expanded]="hasFilteringTrainrunLabels">
    <sbb-expansion-panel-header>
      <ng-container *ngIf="!isFilteringTrainrunLabels()">
        {{ tFilterableLabelsTrainruns }}
      </ng-container>
      <ng-container *ngIf="isFilteringTrainrunLabels()">
        <label style="color: red">{{ tFilterableLabelsTrainruns }}</label>
      </ng-container>
    </sbb-expansion-panel-header>

    <sbb-filterable-label-filter-view
      [componentLabelRef]="'Trainrun'"
    ></sbb-filterable-label-filter-view>
  </sbb-expansion-panel>

  <sbb-expansion-panel [expanded]="hasFilteringNodeLabels">
    <sbb-expansion-panel-header>
      <ng-container *ngIf="!isFilteringNodeLabels()">
        {{ tFilterableLabelsNodes }}
      </ng-container>
      <ng-container *ngIf="isFilteringNodeLabels()">
        <label style="color: red">{{ tFilterableLabelsNodes }}</label>
      </ng-container>
    </sbb-expansion-panel-header>

    <sbb-filterable-label-filter-view
      [componentLabelRef]="'Node'"
    ></sbb-filterable-label-filter-view>
  </sbb-expansion-panel>

  <sbb-expansion-panel [expanded]="hasFilteringNoteLabels">
    <sbb-expansion-panel-header>
      <ng-container *ngIf="!isFilteringNoteLabels()">
        {{ tFilterableLabelsNotes }}
      </ng-container>
      <ng-container *ngIf="isFilteringNoteLabels()">
        <label style="color: red">{{ tFilterableLabelsNotes }}</label>
      </ng-container>
    </sbb-expansion-panel-header>

    <sbb-filterable-label-filter-view
      [componentLabelRef]="'Note'"
    ></sbb-filterable-label-filter-view>
  </sbb-expansion-panel>

  <sbb-expansion-panel [expanded]="false">
    <sbb-expansion-panel-header>
      <ng-container *ngIf="isDisplayFilteringActive()">{{ tDisplay }}</ng-container>
      <ng-container *ngIf="!isDisplayFilteringActive()">
        <label style="color: red">{{ tDisplay }}</label>
      </ng-container>
    </sbb-expansion-panel-header>

    <sbb-label>{{ tTimes }}</sbb-label>
    <div class="sbb-mt-m">
      <sbb-form-field [label]="tDecimalDisplayed">
        <input
          sbbInput
          type="number"
          pattern="^[.0-9]*"
          [(ngModel)]="timeDisplayPrecision"
          (change)="onTimeDisplayPrecisionChanged()"
        />
      </sbb-form-field>
    </div>
    <div class="sbb-checkbox-group-vertical">
      <sbb-checkbox
        [(ngModel)]="filterArrivalDepartureTime"
        (change)="filterArrivalDepartureTimeChanged()"
        >{{ tDisplayArrivalDepartureTimes }}
      </sbb-checkbox>
      <sbb-checkbox
        [(ngModel)]="filterShowNonStopTime"
        (change)="filterShowNonStopTimeChanged()"
      >
        {{ tDisplayArrivalDepartureTimesForConnections }}
      </sbb-checkbox>
      <sbb-checkbox
        [(ngModel)]="filterTravelTime"
        (change)="filterTravelTimeChanged()"
        >{{ tDisplayTravelTimes }}
      </sbb-checkbox>
      <sbb-checkbox
        [(ngModel)]="filterTrainrunName"
        (change)="filterTrainrunNameChanged()"
        >{{ tDisplayTrainrunName }}
      </sbb-checkbox>
    </div>

    <br />
    <sbb-label>{{ tConnections }}</sbb-label>
    <div class="sbb-checkbox-group-vertical">
      <sbb-checkbox
        [(ngModel)]="filterConnections"
        (change)="filterConnectionsChanged()"
        >{{ tDisplayConnections }}
      </sbb-checkbox>
    </div>

    <br />
    <sbb-label>{{ tNodes }}</sbb-label>
    <div class="sbb-checkbox-group-vertical">
      <sbb-checkbox
        [(ngModel)]="filterAllEmptyNodes"
        (change)="filterAllEmptyNodesChanged()"
        >{{ tDisplayNodesWithoutVisibleTrainruns }}
      </sbb-checkbox>
      <sbb-checkbox
        [(ngModel)]="filterAllNonStopNodes"
        (change)="filterAllNonStopNodesChanged()"
        >{{ tDisplayNodesWithOnlyStoppingTrainruns }}
      </sbb-checkbox>
    </div>

    <br />
    <sbb-label>{{ tNotes }}</sbb-label>
    <div class="sbb-checkbox-group-vertical">
      <sbb-checkbox [(ngModel)]="filterNotes" (change)="filterNotesChanged()"
        >{{ tDisplayNotes }}
      </sbb-checkbox>
    </div>

    <button
      sbb-secondary-button
      class="sbb-mt-m"
      [disabled]="isDisplayFilteringActive()"
      [title]="tResetDisplayFilter"
      (click)="onResetDisplayFilter()"
    >
      {{ tResetDisplayFilter }}
    </button>
  </sbb-expansion-panel>

  <sbb-expansion-panel [expanded]="false">
    <sbb-expansion-panel-header>
      {{ tSavedFilters }}
    </sbb-expansion-panel-header>
    <div class="sbb-filtersetting-chip-group">
      <ng-container
        *ngFor="let filterSetting of filterService.getFilterSettings()"
      >
        <ng-container *ngIf="!isActiveEditFilterSetting(filterSetting)">
          <button
            [class]="getFilterSettingClassname(filterSetting)"
            (click)="onFilterSettingChanged(filterSetting)"
            mode="ghost"
            [title]="getFilterSettingTooltip(filterSetting)"
          >
            {{ makeFilterSettingButtonLabel(filterSetting) }}
          </button>

          <button
            [class]="getFilterSettingClassname(filterSetting, true)"
            (click)="onEditFilterSetting(filterSetting)"
            [disabled]="!checkIsFilterSettingActive(filterSetting)"
          >
            <ng-container *ngIf="checkIsFilterSettingActive(filterSetting)">
              <sbb-icon
                svgIcon="pen-medium"
                height="13px"
                width="13px"
                aria-hidden="false"
                style="transform: translate(-4px, 2px);"
              >
              </sbb-icon>
            </ng-container>
            <ng-container *ngIf="!checkIsFilterSettingActive(filterSetting)">
              <sbb-icon
                svgIcon="pen-medium"
                style="color: lightgray"
                height="13px"
                width="13px"
                aria-hidden="false"
                style="transform: translate(-4px, 2px);"
              >
              </sbb-icon>
            </ng-container>
          </button>
        </ng-container>

        <ng-container *ngIf="isActiveEditFilterSetting(filterSetting)">
          <input
            tabindex="-1"
            id="ActiveFilterNameElement"
            type="text"
            maxlength="128"
            spellcheck="false"
            [(ngModel)]="activeFilterName"
          />

          <button
            [class]="getFilterSettingClassname(filterSetting, true)"
            (click)="onEditFilterSettingSave(filterSetting)"
          >
            <sbb-icon
              svgIcon="circle-tick-medium"
              height="13px"
              width="13px"
              aria-hidden="false"
              style="transform: translate(-4px, 2px);"

            >
            </sbb-icon>
          </button>
        </ng-container>

        <button
          [class]="getFilterSettingClassname(filterSetting, true)"
          (click)="onDeleteFilterSetting(filterSetting)"
        >
          <sbb-icon
            svgIcon="trash-medium"
            height="13px"
            width="13px"
            aria-hidden="false"
            style="transform: translate(-4px, 2px);"
          >
          </sbb-icon>
        </button>
        <br />
      </ng-container>
      <button
        [class]="getFilterSettingAddButtonClassname()"
        (click)="onSaveAsNewFilterSetting()"
        mode="ghost"
        [title]="tSaveFilters"
      >
        <sbb-icon
          svgIcon="circle-plus-medium"
          style="margin-top: 3px; transform: translate(-4px, 2px);"
        ></sbb-icon>
      </button>
    </div>
  </sbb-expansion-panel>
</sbb-accordion>

<div style="transform: translate(24px, 10px)">
  <button
    sbb-secondary-button
    class="sbb-mt-m"
    [disabled]="!this.filterService.isAnyFilterActive()"
    [title]="tResetAllDisplayFilters"
    (click)="onResetAllFilter()"
  >
    {{ tResetAllDisplayFilters }}
  </button>
</div>
